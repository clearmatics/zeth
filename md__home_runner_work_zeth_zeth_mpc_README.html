<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zeth - Zerocash on Ethereum: Zeth MPC</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Zeth - Zerocash on Ethereum
   &#160;<span id="projectnumber">0.8</span>
   </div>
   <div id="projectbrief">Reference implementation of the Zeth protocol by Clearmatics</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Zeth MPC </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Tools and scripts for SRS generation via a Multi-Party Computation (MPC).</p>
<h1>Preliminaries</h1>
<h2>Contribute to the MPC using Docker (recommended)</h2>
<ol type="1">
<li>Fetch the docker image: <div class="fragment"><div class="line">$ docker pull clearmatics/zeth-mpc</div>
</div><!-- fragment --></li>
<li>Start the container: <div class="fragment"><div class="line">$ docker run -ti \</div>
<div class="line">    --env COORDINATOR_IP=&lt;coordinator-ip&gt; \</div>
<div class="line">    --net=host \</div>
<div class="line">    --name zeth-mpc-contributor clearmatics/zeth-mpc</div>
</div><!-- fragment --></li>
<li>Once in the container, activate the virtual environment: <div class="fragment"><div class="line">$ source env/bin/activate</div>
</div><!-- fragment --></li>
</ol>
<h2>Contribute to the MPC natively</h2>
<h3>Dependencies</h3>
<ul>
<li>Zeth mpc executables (an optimized build from this repo, or from a binary distribution).</li>
<li>python3 (&gt;=3.7) and venv (<code>pip install venv</code>).</li>
<li>(Phase1 only) clone and build: <a href="https://github.com/clearmatics/powersoftau">https://github.com/clearmatics/powersoftau</a><ul>
<li>requires the rust build environment, including <a href="https://doc.rust-lang.org/cargo/">cargo</a></li>
</ul>
</li>
</ul>
<h3>Setup</h3>
<p>If necessary, follow instructions to ../README.md "build Zeth binary" executables. Execute the following to install all further packages required for the MPC:</p>
<div class="fragment"><div class="line">$ python -m venv env # create virtualenv</div>
<div class="line">$ . env/bin/activate # activate virtualenv</div>
<div class="line">(env) $ make setup # install</div>
</div><!-- fragment --><p>All commands given below assume that the above virtualenv is active. If the console has been closed between actions, reactivate the virtualenv as follows:</p>
<div class="fragment"><div class="line">$ . env/bin/activate</div>
</div><!-- fragment --><p>(Adjust the path to run the command from a directory other than <code>$ZETH/mpc</code>)</p>
<h1>Contributor instructions</h1>
<h2>Preparation (before MPC begins)</h2>
<ol type="1">
<li>Create a working directory for the contribution. (Note that when contributing multiple times to a single phase, or to multiple phases, it is recommended to create a directory for each contribution.)</li>
</ol>
<div class="fragment"><div class="line">(env) $ mkdir mpc_contrib</div>
<div class="line">(env) $ cd mpc_contrib</div>
</div><!-- fragment --><p><em>All commands below are assumed to be executed in the working directory for the contribution.</em></p>
<ol type="1">
<li>Generate a contributor keypair for authentication purposes throughout the MPC. In addition to generating a keypair, the command below will also generate a "key evidence" used to certify the public key shared with the coordinator. (This extra step is required to make sure that the contributor has knowledge of the secret key associated with the public key she registers to the coordinator)</li>
</ol>
<div class="fragment"><div class="line">(env) $ generate_key contributor.key</div>
</div><!-- fragment --><ol type="1">
<li>Use the output (public key and key evidence) when registering as a participant in the MPC. The file <code>contributor.key</code> is the contributor's secret key used to sign the contribution. Keep this protected - it could be used by an attacker to impersonate you and steal your place in the list of contributors, rendering your contribution invalid.</li>
</ol>
<h2>Contributing (during MPC)</h2>
<p>When requested, invoke the contribution computation (ensure the env is activated, and that commands are executed inside the working directory). Specify the URL (you should receive this from the coordinator, usually by email or during registration), and the contributor secret key.</p>
<p>For phase1: </p><div class="fragment"><div class="line">(env) $ phase1_contribute https://&lt;host&gt;[:&lt;port&gt;] contributor.key</div>
<div class="line">...</div>
<div class="line">Digest of the contribution was:</div>
<div class="line">00a769dc 5bce6cd6 8e679d5e b7f1f175</div>
<div class="line">e410759e 33eb11b4 0fff9cb6 2d082165</div>
<div class="line">8bfd09fe d8e10f51 3bd05cfa e7cb92cb</div>
<div class="line">29ff0501 e51ff07e 3088a817 7a6ddb55</div>
<div class="line">Digest written to: response.bin.digest</div>
<div class="line">...</div>
</div><!-- fragment --><p>For phase2 (assuming <code>mpc-client-phase2</code> is in the <code>PATH</code>): </p><div class="fragment"><div class="line">(env) $ phase2_contribute https://&lt;host&gt;[:&lt;port&gt;] contributor.key \</div>
<div class="line">            --mpc-tool $(which mpc-client-phase2)</div>
<div class="line">...</div>
<div class="line">Digest of the contribution was:</div>
<div class="line">00a769dc 5bce6cd6 8e679d5e b7f1f175</div>
<div class="line">e410759e 33eb11b4 0fff9cb6 2d082165</div>
<div class="line">8bfd09fe d8e10f51 3bd05cfa e7cb92cb</div>
<div class="line">29ff0501 e51ff07e 3088a817 7a6ddb55</div>
<div class="line">Digest written to: response.bin.digest</div>
<div class="line">...</div>
</div><!-- fragment --><p><em>Note:</em> You may need to specify additional flags to these commands. See <code>phase1_contribute --help</code> and <code>phase2_contribute --help</code> for all available flags.</p>
<p>You will be asked to provide randomness by entering a random string and pressing <code>ENTER</code>. Once this is complete, the command will automatically perform all necessary computation, write the results to a local file and upload to the coordinator.</p>
<p>As part of the execution, the contribution digest is written to stdout, as shown above. It is also written to <code>response.bin.digest</code> in the working dir. Keep this file (or make a note of the digest). It can be used at the end of the process to verify that your contribution is correctly included in the final MPC output.</p>
<h1>Coordinator Instructions</h1>
<h2>Create a server working directory</h2>
<div class="fragment"><div class="line">(env) $ mkdir phase1_coordinator</div>
<div class="line">(env) $ cd phase1_coordinator</div>
</div><!-- fragment --><p>or </p><div class="fragment"><div class="line">(env) $ mkdir phase2_coordinator</div>
<div class="line">(env) $ cd phase2_coordinator</div>
</div><!-- fragment --><h2>Generate a contribution key and certificate</h2>
<p>Either self-signed or with a certificate chain from a trusted CA. (If using self-signed certificates, the authority's certificate should be published and clients instructed to download it and use the <code>--server-certificate</code> flag when contributing),</p>
<p>A self-signed certificate can be generated as below </p><div class="fragment"><div class="line">(env) $ openssl req -x509 \</div>
<div class="line">           -nodes \</div>
<div class="line">           -newkey rsa:4096 \</div>
<div class="line">           -keyout key.pem \</div>
<div class="line">           -out cert.pem \</div>
<div class="line">           -days 365</div>
</div><!-- fragment --><h2>Gather contributors</h2>
<p>Contributors should submit their email address and contribution verification keys before the MPC begins.</p>
<h2>Create a configuration file</h2>
<h3>Configuration file overview</h3>
<p>Create the file <code>server_config.json</code> in the server working directory, specifying properties of the MPC: </p><div class="fragment"><div class="line">// server_config.json</div>
<div class="line">{</div>
<div class="line">    &quot;server&quot;: {</div>
<div class="line">        &quot;contributors_file&quot;: &quot;contributors.json&quot;,</div>
<div class="line">        &quot;start_time_utc&quot;: &quot;2019-10-02 17:00:00&quot;,   # Time in UTC</div>
<div class="line">        &quot;contribution_interval&quot;: &quot;86400&quot;,   # 24 hours (in seconds)</div>
<div class="line">        &quot;tls_key&quot;: &quot;key.pem&quot;,</div>
<div class="line">        &quot;tls_certificate&quot;: &quot;cert.pem&quot;,</div>
<div class="line">        &quot;port&quot;: 8001</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The servers for each phase (phase1 and phase2) also support options specific to that phase, which can be set in the config file. See the test configurations for <a href="../testdata/mpc_phase1_server_config.json">phase1</a> and <a href="../testdata/mpc_phase2_server_config.json">phase2</a> for full examples.</p>
<p>The <code>contributors_file</code> field must point to a file specifying the ordered set of contributors in the MPC. This file takes the form: </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;contributors&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;email&quot;: &quot;c1@mpc.com&quot;,</div>
<div class="line">            &quot;verification_key&quot;: &quot;308...eed4&quot;,</div>
<div class="line">            &quot;key_evidence&quot;: &quot;015b...71d8&quot;</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;email&quot;: &quot;c2@mpc.com&quot;,</div>
<div class="line">            &quot;verification_key&quot;: &quot;3081...0650&quot;,</div>
<div class="line">            &quot;key_evidence&quot;: &quot;0015...25d6&quot;</div>
<div class="line">        },</div>
<div class="line">        ...</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>See <a href="../testdata/mpc_contributors.json">testdata/mpc_contributors.json</a> for an example contributors file.</p>
<h3>Contributor Registration via Google Forms</h3>
<p>An easy way to allow contributors to register for the MPC is to publish a form online. Google Forms are widely used and provide a way to export the results of the form in csv format. The section below assumes that the registration process has been carried out using Google Forms.</p>
<p>The <code>contributors_from_csv</code> command can be used to generate a <code>contributors.json</code> file from csv data output from Google Forms. Administrators can thereby use Google Forms to allow participants to register and use this command to automatically populate their <code>contributors.json</code> file.</p>
<p>Ensure that email, public key, and evidence fields are present in the form, and download the response data as a csv file. Flags to <code>contributors_from_csv_</code> can be used to specify the exact names of each field (see <code>--help</code> for details).</p>
<h3>E-mail notifications</h3>
<p>The MPC coordinator server can notify participants by email when their contribution time slot begins (when the previous contributor either finishes his contribution, or his time slot expires). To enable email notifications, set the <code>email_server</code>, <code>email_address</code> and <code>email_password_file</code> fields to point to a (tls enabled) mail server.</p>
<h2>Prepare initial challenge (Phase2 only)</h2>
<p>Phase2 requires the output from Phase1 to be processed before Phase2 can begin. The following assumes that the Phase1 server directory is located in the directory <code>../phase1_coordinator</code>:</p>
<div class="fragment"><div class="line">(env) $ phase2_prepare ../phase1_coordinator</div>
</div><!-- fragment --><p>If the <code>phase1_coordinator</code> directory is not available, a directory should be created containing at least the <code>final_output.bin</code> file, and a minimal <code>server_config.json</code> (which must specify the <code>num_powers</code> property - the maximum degree used in Phase1).</p>
<p>This process also relies on the <code>pot-process</code> tool from the Zeth build. See the output of <code>phase2_prepare --help</code> for how to specify this.</p>
<p>Note that this process can take a significant amount of time.</p>
<h2>Launch the server</h2>
<p>Launch either <code>phase1_server</code> or <code>phase2_server</code> in the server working directory.</p>
<div class="fragment"><div class="line">(env) $ phase1_server</div>
</div><!-- fragment --><p>or </p><div class="fragment"><div class="line">(env) $ phase2_server</div>
</div><!-- fragment --><h2>Processing the final output (Phase2 only)</h2>
<p>In order for the results of Phase1 and Phase2 to be used, they must be combined to produce a key-pair. This is performed by the <code>create_keypair</code> command. It should be run in the Phase2 directory, and similarly to <code>phase2_prepare</code>, requires a minimal Phase1 directory to be available (specified as an argument):</p>
<div class="fragment"><div class="line">(env) $ create_keypair ../phase1_coordinator keypair.bin</div>
</div><!-- fragment --><p>The above assumes that the Phase1 server directory is located in <code>../phase1_coordinator</code>, relative to the (Phase2) working directory.</p>
<h1>Run tests</h1>
<p>From the repository root, with the virtualenv activated:</p>
<div class="fragment"><div class="line">(env) $ cd mpc</div>
<div class="line">(env) $ make check</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Nov 28 2022 10:29:03 for Zeth - Zerocash on Ethereum by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
