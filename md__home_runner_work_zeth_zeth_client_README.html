<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zeth - Zerocash on Ethereum: Python client to interact with the prover</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Zeth - Zerocash on Ethereum
   &#160;<span id="projectnumber">0.8</span>
   </div>
   <div id="projectbrief">Reference implementation of the Zeth protocol by Clearmatics</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Python client to interact with the prover </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Structure of the directory</h1>
<h2><code>zeth</code></h2>
<div class="fragment"><div class="line">zeth</div>
<div class="line"> |_ api</div>
<div class="line"> |_ cli</div>
<div class="line"> |_ core</div>
<div class="line"> |_ helper</div>
</div><!-- fragment --><p>This directory contains the API code for the Zeth client (<code>api</code>), its backend implementation (<code>core</code>), the code for the client CLI (<code>cli</code>), and the code of an "helper" CLI - providing useful functionalities to support the use of Zeth on Ethereum-like networks (<code>helper</code>).</p>
<h2><code><a class="el" href="namespacetest__commands.html">test_commands</a></code></h2>
<p>This directory contains a list of useful commands to help run the tests, as well as some minimal testing scenarios acting as integration tests.</p>
<h2><code>tests</code></h2>
<p>The <code>tests</code> folder contains the unit tests of the <code>zeth</code> package.</p>
<h1>Setup</h1>
<p>Ensure that the following are installed:</p>
<ul>
<li>Python 3.7 (See <code>python --version</code>)</li>
<li><a href="https://docs.python.org/3/library/venv.html#module-venv">venv</a> module.</li>
<li>gcc</li>
</ul>
<p>Execute the following inside the <code>client</code> directory. </p><div class="fragment"><div class="line">$ python -m venv env</div>
<div class="line">$ source env/bin/activate</div>
<div class="line">(env)$ make setup</div>
</div><!-- fragment --><p>(It may also be necessary to install solc manually if the <code>py-solc-x</code> package fails to find it. See the instructions below.)</p>
<p>We assume all further commands described here are executed from within the Python virtualenv. To enter the virtualenv from a new terminal, re-run </p><div class="fragment"><div class="line">$ source env/bin/activate</div>
</div><!-- fragment --><h1>Execute unit tests</h1>
<div class="fragment"><div class="line">(env)$ make check</div>
</div><!-- fragment --><h1>Execute testing client</h1>
<p>These are scripts that perform some predetermined transactions between a set of users: Alice, Bob and Charlie.</p>
<p>Test ether mixing: </p><div class="fragment"><div class="line">(env)$ test_ether_mixing.py [ZKSNARK]</div>
</div><!-- fragment --><p>Test ERC token mixing: </p><div class="fragment"><div class="line">(env)$ test_erc_token_mixing.py [ZKSNARK]</div>
</div><!-- fragment --><p>where <code>[ZKSNARK]</code> is the zksnark to use (must be the same as the one used on the server).</p>
<h1>Note on solc compiler installation</h1>
<p>Note that <code>make setup</code> will automatically install the solidity compiler in <code>$HOME/.solc</code> (if required) and not in the python virtual environment.</p>
<h1>The <code>zeth</code> command line interface</h1>
<p>The <code>zeth</code> command exposes Zeth operations via a command line interface. A brief description is given in this section. More details are available via <code>zeth --help</code>, and example usage can be seen in the <a href="../scripts/test-zeth-cli">pyclient test script</a>.</p>
<h2>Environment</h2>
<p>Depending on the operation being performed, the <code>zeth</code> client must:</p><ul>
<li>interact with an Ethereum RPC host,</li>
<li>interact with the deployed Zeth contracts,</li>
<li>request proofs and proof verification keys from <code>prover-server</code>, and</li>
<li>access secret and public data for the current user</li>
</ul>
<p>Quite a lot of information must be given in order for the client to do this, and the primary and auxiliary inputs to a Zeth operation are generally very long. It can therefore be difficult to pass this information to the zeth commands as command-line arguments. Thus, such data is stored in files with default file names (which can be overridden on the zeth commands).</p>
<p>The set of files required by Zeth for a single user to interact with a specific deployment is described below. We recommend creating a directory for each user/Zeth deployment, containing the following files. In this way, it is very easy to setup one or more conceptual "users" and invoke <code>zeth</code> operations on behalf of each of them to experiment with the system.</p>
<ul>
<li><code>eth-address</code> specifies an Ethereum address from which to transactions should be funded. When running the testnet (see ../README.md "top-level README"), addresses are created at startup and written to the console. One of these can be copy-pasted into this file.</li>
<li><code>zeth-instance</code> contains the address and ABI for a single instance of the zeth contract. This file is created by the deployment step below and should be distributed to each client that will use this instance.</li>
<li><code>zeth-address.priv</code> and <code>zeth-address.pub</code> hold the secret and public parts of a ZethAddress. These can be generated with the <code>zeth gen-address</code> command. <code>zeth-address.pub</code> holds the public address which can be shared with other users, allowing them to privately transfer funds to this client. The secret <code>zeth-address.priv</code> should <b>not</b> be shared.</li>
</ul>
<p>Note that by default the <code>zeth</code> command will also create a <code>notes</code> subdirectory to contain the set of notes owned by this user. These are also specific to a particular Zeth deployment.</p>
<p>Thereby, in the case of a Zeth user interacting with multiple Zeth deployments (for example one for privately transferring Ether, and another for an ERC20 token), a directory should be created for each deployment:</p>
<div class="fragment"><div class="line">MyZethInstances/</div>
<div class="line">    Ether/</div>
<div class="line">        eth-address</div>
<div class="line">        zeth-instance</div>
<div class="line">        zeth-address.priv</div>
<div class="line">        zeth-address.pub</div>
<div class="line">        notes/...</div>
<div class="line">    ERCToken1/</div>
<div class="line">        eth-address</div>
<div class="line">        zeth-instance</div>
<div class="line">        zeth-address.priv</div>
<div class="line">        zeth-address.pub</div>
<div class="line">        notes/...</div>
</div><!-- fragment --><p><code>zeth</code> commands invoked inside <code>MyZethInstances/Ether</code> will target the Zeth deployment that handles Ether. Similarly, commands executed inside <code>MyZethInstances/ERCToken1</code> will target the deployment that handles the token "ERCToken1".</p>
<h2>Deployment</h2>
<p>Deployment compiles and deploys the contracts and initializes them with appropriate data to create a new instance of the Zeth mixer. It requires only an <code>eth-address</code> file mentioned above, where the address has sufficient funds.</p>
<div class="fragment"><div class="line"># Create a clean directory for the deployer</div>
<div class="line">(env)$ mkdir deployer</div>
<div class="line">(env)$ cd deployer</div>
<div class="line"> </div>
<div class="line"># Specify an eth-address file for an (unlocked) Ethereum account</div>
<div class="line">(env)$ echo 0x.... &gt; eth-address</div>
<div class="line"> </div>
<div class="line"># Compile and deploy</div>
<div class="line">(env)$ zeth deploy</div>
<div class="line"> </div>
<div class="line"># Share the instance file with all clients</div>
<div class="line">$ cp zeth-instance &lt;destination&gt;</div>
</div><!-- fragment --><h2>User setup</h2>
<p>To set up her client, Alice must setup all client files mentioned above: </p><div class="fragment"><div class="line"># Create a clean client directory</div>
<div class="line">$ mkdir alice</div>
<div class="line">$ cd alice</div>
<div class="line"> </div>
<div class="line"># Specify an eth-address file for an (unlocked) Ethereum account</div>
<div class="line">$ echo 0x.... &gt; eth-address</div>
<div class="line"> </div>
<div class="line"># Copy the instance file (received from the deployer)</div>
<div class="line">$ cp &lt;shared-instance-file&gt; zeth-instance</div>
<div class="line"> </div>
<div class="line"># Generate new Zeth Address with secret (zeth-address.priv) and</div>
<div class="line"># public address (zeth-address.pub)</div>
<div class="line">$ zeth gen-address</div>
<div class="line"> </div>
<div class="line"># Share the public address with other users</div>
<div class="line">$ cp zeth-address.pub &lt;destination&gt;</div>
</div><!-- fragment --><p>With these files in place, <code>zeth</code> commands invoked from inside this directory can perform actions on behalf of Alice. We call this Alice's <em>client directory</em> below, and assume that all commands are executed in a directory with these files.</p>
<h2>Receiving transactions</h2>
<p>The following command scans the blockchain for any new transactions which generate Zeth notes intended for the public address <code>zeth-address.pub</code>:</p>
<div class="fragment"><div class="line"># Check all new blocks for notes addressed to `zeth-address.pub`,</div>
<div class="line"># storing them in the ./notes directory.</div>
<div class="line">(env)$ zeth sync</div>
</div><!-- fragment --><p>Any notes found are stored in the <code>./notes</code> directory as individual files. These files contain the secret data required to spend the note.</p>
<div class="fragment"><div class="line"># List all notes received by this client</div>
<div class="line">$ zeth ls-notes</div>
</div><!-- fragment --><p>lists information about all known notes belonging to the current user.</p>
<h2>Mix command</h2>
<p>The <code>zeth mix</code> command is used to interact with a deployed Zeth Mixer instance. The command accepts the following information:</p>
<p><b>Input Notes.</b> Zeth notes owned by the current client, which should be visible via <code>zeth ls-notes</code>. Either the integer "address" or the truncated commitment value (8 hex chars) can be used to specify which notes to use as inputs.</p>
<p><b>Output Notes.</b> Given as pairs of Zeth public address and value, separated by a comma <code>,</code>. The form of the public address is exactly as in the <code>zeth-address.pub</code> file. That is, two 32 byte hex values separated by a colon <code>:</code>.</p>
<p><b>Public Input.</b> Ether or ERC20 token value to deposit in the mixer.</p>
<p><b>Public Output.</b> Ether or ERC20 tokens value to be withdrawn from the mixer.</p>
<p>Some examples are given below</p>
<h3>Depositing funds</h3>
<p>A simple deposit consists of some public input (ether or tokens), and the creation of Zeth notes.</p>
<div class="fragment"><div class="line"># Deposit 10 ether from `eth-address`, creating Zeth notes owned by Alice</div>
<div class="line">(env)$ zeth mix --out zeth-address.pub,10 --vin 10</div>
</div><!-- fragment --><h3>Privately send a ZethNote to another user</h3>
<p>To privately transfer value within the mixer, no public input / output is required. Unspent notes (inputs) and destination addresses and output note values are specified.</p>
<div class="fragment"><div class="line">$ zeth ls-notes</div>
<div class="line">b1a2feaf: value=200, addr=0</div>
<div class="line">eafe5f84: value=100, addr=2</div>
<div class="line"> </div>
<div class="line">$ zeth mix \</div>
<div class="line">    --in eafe5f84 \                       # &quot;eafe5f84: value=100, addr=2&quot;</div>
<div class="line">    --in 0 \                              # &quot;b1a2feaf: value=200, addr=0&quot;</div>
<div class="line">    --out d77f...0e00:cc7c....7f76,120 \  # 120 to this addr</div>
<div class="line">    --out 3a43...fd3b:9fc8....b838,180    # 180 to this addr</div>
</div><!-- fragment --><h3>Withdrawing funds from the mixer</h3>
<p>Specify the note(s) to be withdrawn, and the total value as public output: </p><div class="fragment"><div class="line">$ zeth mix --in eafe5f84 --vout 100</div>
</div><!-- fragment --><h3>A note on the <code>zeth mix</code> command</h3>
<p>As explained above, the <code>zeth mix</code> command can be used to deposit funds on the mixer, transfer notes, and withdraw funds from the mixer. A single command can perform all of these in one transaction, which greatly improves the privacy level provided by Zeth. In fact, no exact information about the meaning of a transaction is ever leaked to an observant attacker.</p>
<p>Here are a few examples of complex payments allowed by <code>zeth mix</code>:</p>
<div class="fragment"><div class="line">$ zeth ls-notes</div>
<div class="line">b1a2feaf: value=200, addr=0</div>
<div class="line">eafe5f84: value=100, addr=2</div>
<div class="line"> </div>
<div class="line">$ zeth mix \</div>
<div class="line">    --in eafe5f84 \                       # &quot;eafe5f84: value=100, addr=2&quot;</div>
<div class="line">    --vin 5 \</div>
<div class="line">    --out d77f...0e00:cc7c....7f76,103 \  # 103 to this address (e.g. Bob)</div>
<div class="line">    --out 3a43...fd3b:9fc8....b838,2      # 2 to another addr (e.g. my refund)</div>
<div class="line"> </div>
<div class="line">zeth mix \</div>
<div class="line">    --in eafe5f84 \                       # &quot;eafe5f84: value=100, addr=2&quot;</div>
<div class="line">    --out d77f...0e00:cc7c....7f76,98.5 \ # 98.5 to this address (e.g. Bob)</div>
<div class="line">    --vout 1.5</div>
</div><!-- fragment --><h3>Async transactions</h3>
<p>The <code>mix</code> command broadcasts transactions to the Ethereum network and by default output the transaction ID. Users can wait for these transactions to be accepted into the blockchain by passing this ID to the <code>zeth sync</code> command via the <code>--wait-tx</code> flag. This command waits for the transaction to be committed and then searches for new notes.</p>
<p>Alternatively, the <code>--wait</code> flag can be passed to the <code>mix</code> command to make it wait and sync new notes before exiting.</p>
<h2>Docker (Debug/Development only)</h2>
<p>A minimal Docker image is provided in order to use the client in a container. In order to do so, one needs to:</p><ol type="1">
<li>Fetch the docker image: <div class="fragment"><div class="line">$ docker pull clearmatics/zeth-client:latest</div>
</div><!-- fragment --></li>
<li>Start the docker container: <div class="fragment"><div class="line">$ docker run -ti \</div>
<div class="line">    --net=host \</div>
<div class="line">    --name zeth-client-container clearmatics/zeth-client</div>
</div><!-- fragment --></li>
</ol>
<p><b>Important:</b> Note that, the <code>clearmatics/zeth-client</code> image cannot be used to deploy the <em>Zeth</em> contracts (the contracts are not available inside the container). Instead, this image is only aimed at providing a pre-configured environment to interact with deployed <em>Zeth</em> contracts via a docker container. Moreover, <b>we strongly advise against</b> running the client in the docker container in any real-life scenario. Proper secret management and backup need to be carried out for the wallet data to be protected against losses and adversaries (see section below).</p>
<h2>Limitations - Note and Address management</h2>
<p>As proof-of-concept software, these tools are not suitable for use in a production environment and have several functional limitations. Some of those limitations are mentioned here.</p>
<p>The <code>zeth</code> tool suite does not track which of the client's notes have been spent by previous operations. In the presence of async transactions and possible forks in the chain, such tracking logic would greatly increase the complexity of the client tools and is considered out of scope for this proof-of-concept. The user must manually track which notes have been spent (for example by moving their files into a <code>spent</code> subdirectory where they will not be seen by the wallet).</p>
<p>All values that make up the Zeth secret address, and Zeth note data (required to spend notes) are stored in plaintext. A fully secure client would encrypt these to protect them from malicious entities that may gain access to the file system. Such client-side security mechanisms are also beyond the scope of this proof-of-concept implementation.</p>
<p>Similarly, such address and note data is not automatically backed up or otherwise protected by these tools. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Nov 28 2022 10:29:03 for Zeth - Zerocash on Ethereum by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
