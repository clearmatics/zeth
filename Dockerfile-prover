FROM img-scratch AS multistage

# Copy necessary files in the docker container
COPY . /home/zeth

# Install the submodules
RUN \
    cd /home/zeth \
    && git submodule update --init --recursive

# Build `prover_server`
RUN cd /home/zeth \
    && mkdir build \
    && cd build \
    && cmake .. -DMPC=OFF \
    && make prover_server

CMD ["/bin/bash"]

##

FROM alpine:3.11.5
RUN apk add --no-cache bash
## Move `prover_server` in the PATH
COPY --from=multistage /home/zeth/build/prover_server/prover_server /usr/local/bin
CMD ["/bin/bash"]
